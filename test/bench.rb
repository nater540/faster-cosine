require 'benchmark/ips'
require_relative '../lib/faster_cosine'

vector1 = [-0.060268137603998184, -0.05884791910648346, -0.09734241664409637, -0.06888674944639206, 0.07756020873785019, 0.0564102828502655, 0.010685203596949577, 0.0435410737991333, 0.0557655468583107, -0.08356546610593796, 0.02282107062637806, -0.0019932405557483435, 0.018258458003401756, -0.06866960972547531, 0.036197613924741745, -0.06758152693510056, -0.06433585286140442, 0.01601579040288925, -0.054497119039297104, -0.012243565171957016, -0.06424720585346222, 0.07661303877830505, 0.009530718438327312, -0.011023884639143944, -0.03826310858130455, 0.0645303875207901, 0.015738604590296745, -0.007619606330990791, -0.004175021778792143, -0.04191729426383972, 0.07871990650892258, -0.025052480399608612, 0.05521182715892792, 0.04347186163067818, 0.062424302101135254, 0.01907271333038807, -0.0359237939119339, -0.04417156055569649, -0.09361988306045532, 0.036660537123680115, -0.010928142815828323, -0.026738371700048447, 0.04494529217481613, 0.08087397366762161, -0.033828187733888626, 0.09124857932329178, 0.059130147099494934, -0.03742942959070206, 0.012955513782799244, -0.012327208183705807, 0.03306199237704277, -0.055704791098833084, -0.08427928388118744, 0.019375840201973915, 0.03141076862812042, -0.003134226892143488, 0.0006255259504541755, -0.02924959734082222, 0.001949032535776496, -0.003217048244550824, 0.03847776725888252, 0.04603199288249016, 0.0012864007148891687, -0.027571778744459152, 0.09248387813568115, 0.08006276935338974, -0.016705935820937157, -0.08209141343832016, -0.03521576523780823, 0.032819751650094986, -0.038098081946372986, 0.13920921087265015, -0.0067762210965156555, 0.03833401948213577, 0.011534632183611393, 0.057443421334028244, 0.040983691811561584, 0.02150687761604786, 0.06128311529755592, -0.06246856227517128, -0.0015228004194796085, -0.01583990827202797, -0.010286320000886917, 0.09731300920248032, 0.06487100571393967, -0.07705646008253098, -0.014551104977726936, -0.04603608325123787, 0.0030732103623449802, 0.01806531846523285, -0.052569709718227386, 0.024234827607870102, 0.03137487545609474, -0.0320853516459465, -0.10070600360631943, -0.010149399749934673, 0.02892760932445526, -0.041864536702632904, -0.04526665061712265, 0.00975970458239317, -0.022108422592282295, 0.02895745262503624, -0.025937767699360847, 0.007568236440420151, -0.004611148964613676, 0.031830742955207825, -0.09641627967357635, 0.06505972892045975, -0.06067993491888046, -0.022417951375246048, -0.045702628791332245, -0.008593696169555187, -0.053140051662921906, -0.04656229540705681, -0.002426055958494544, -0.08849331736564636, -0.002873412799090147, -0.10064627975225449, 0.057107534259557724, -0.05331995710730553, -0.025697827339172363, 0.0613524504005909, 0.03812190517783165, -0.07838097214698792, -0.007590234745293856, -0.005830368492752314, 0.04278772696852684, -0.0048109786584973335, -0.09032658487558365, 0.07717260718345642, -0.032056551426649094, -0.028463300317525864, 0.0007452909485436976, 0.0009604608057998121, -0.06987305730581284, 0.00940692238509655, -0.05300680547952652, 0.060039814561605453, -0.06655990332365036, -0.004116628784686327, -0.015694310888648033, 0.026966078206896782, 0.05959872528910637, -0.03644569590687752, 0.022458255290985107, 0.001668381504714489, -0.06314554810523987, -0.0020646308548748493, 0.03440365940332413, 0.020726105198264122, 0.06378813832998276, 0.04047898203134537, 0.028752349317073822, -0.05698256939649582, -0.006917532999068499, 0.04529772326350212, 0.011846926994621754, 0.007125353440642357, 0.002804823685437441, -0.00914701260626316, -0.049280449748039246, -0.03899155184626579, -0.00022836934658698738, 0.0433395653963089, -0.12906695902347565, -0.11502309143543243, 0.024407215416431427, 0.062087710946798325, 0.0787295326590538, 0.05454346165060997, 0.005099258851259947, -0.060015153139829636, 0.0425201877951622, 0.0457146093249321, 0.02629419043660164, -0.019210293889045715, 0.03387895226478577, 0.0051735034212470055, 0.034539952874183655, 0.015413721092045307, 0.06418580561876297, 0.012016952969133854, -0.042485881596803665, -0.08238977938890457, -0.02986251749098301, -0.004785032011568546, -0.024383898824453354, 0.010998884215950966, -0.005728630349040031, 0.04963736608624458, 0.025273356586694717, -0.012082311324775219, -0.06207007169723511, 0.025348011404275894, 0.0217976626008749, -0.03617200255393982, 0.05658083036541939, -0.07071997970342636, 0.042317554354667664, -0.04607388749718666, 0.08218041062355042, -0.02332359179854393, -0.034863028675317764, 0.022008586674928665, -0.09140816330909729, 0.02280982956290245, 0.033323533833026886, -0.033084481954574585, -0.004654903430491686, 0.023243745788931847, 0.02829938754439354, 0.03978368267416954, 0.021108249202370644, -0.016330702230334282, 0.038455601781606674, -0.030264372006058693, -0.09704466909170151, 0.004488613922148943, 0.03945883736014366, 0.04405907914042473, -0.018053773790597916, 0.03462745621800423, 0.01732703670859337, 0.003970740363001823, -0.00906444527208805, -0.04298781976103783, 0.03470342233777046, -0.029868919402360916, -0.003515003016218543, 0.028766244649887085, -0.06818360835313797, -0.026268206536769867, 0.020023982971906662, -0.05313184857368469, 0.043916624039411545, -0.10422269254922867, -0.011362730525434017, -0.13513100147247314, -0.008547247387468815, -0.07195743173360825, -0.012030710466206074, -0.07901543378829956, 0.0563400536775589, 0.01714419759809971, 0.027614504098892212, 0.014672365970909595, -0.024746086448431015, 0.006550523452460766, -0.04699664190411568, -0.06953888386487961, 0.038992419838905334, 0.13948693871498108, 0.05648549273610115, -0.06946337223052979, -0.07500273734331131, 0.00891973078250885, 0.007359535899013281, 0.1280461698770523, -0.11097855865955353, -0.06766346096992493, 0.1318819522857666, 0.08025384694337845, 0.053418610244989395, 0.02592308074235916, 0.11786750704050064, 0.03793668746948242, 0.0009800645057111979, 0.11937406659126282, -0.03180338442325592, 0.026381609961390495, -0.004030670505017042, -0.00275554321706295, 0.03128993883728981, 0.07819443196058273, -0.01908355951309204, -0.10350378602743149, 0.013588586822152138, 0.020392058417201042, -0.04743027314543724, 0.11227839440107346, 0.0740869790315628, -0.07184675335884094, 0.04709684103727341, -0.030106065794825554, 0.02868020348250866, 0.05562742054462433, 0.02700944058597088, 0.07009155303239822, 0.03736924007534981, 0.004386126529425383, -0.016657624393701553, 0.08870775252580643, 0.06373231112957001, -0.11071012169122696, -0.05350949615240097, -0.018789425492286682, -0.057370103895664215, 0.0033700107596814632, 0.027412358671426773, -0.0800636038184166, -0.031648993492126465, 0.08805254846811295, 0.00879506766796112, 0.03730088844895363, -0.04079475998878479, -0.0509585402905941, 0.06830716133117676, 0.056273072957992554, 0.019255194813013077, -0.028539035469293594, 0.09375473111867905, 0.0182631965726614, 0.03280184417963028, -0.05149276554584503, -0.05155034735798836, 0.056064918637275696, -0.04758966341614723, 0.056793294847011566, 0.0758911520242691, 0.0030813273042440414, -0.03165356069803238, -0.02023988962173462, 0.025847716256976128, 0.0039415424689650536, -0.010641202330589294, -0.02434704452753067, 0.053021322935819626, 0.038595184683799744, -0.07736929506063461, 0.021490490064024925, 0.062671959400177, 0.01817033626139164, -0.06652817875146866, -0.0031129512935876846, -0.018301405012607574, 0.04626970365643501, -0.04120969772338867, -0.019097615033388138, -0.015646617859601974, -0.024173785001039505, -0.021535562351346016, 0.03655152767896652, 0.14226821064949036, 0.028897006064653397, -0.020693374797701836, 0.029240652918815613, -0.030840065330266953, 0.04138410463929176, 0.032470788806676865, 0.0023929323069751263, 0.01660541631281376, 0.009551380760967731, 0.029598001390695572, -0.05810055509209633, 0.007982632145285606, -0.08142058551311493, 0.06808008253574371, -0.04647214338183403, 0.07793787866830826, -0.002147448481991887, 0.06871569156646729, 0.038489967584609985, -0.09049602597951889, -0.005376765970140696, 0.054401662200689316, -0.031601302325725555, -0.016190698370337486, 0.04433843865990639, -0.0017586887115612626, -0.005737821105867624, 0.05777886509895325, -0.008459252305328846, -0.0466524176299572, -0.01799919456243515, -0.012643303722143173, -0.11377491056919098, -0.05379576236009598, -0.013076303526759148, -0.02139647863805294, 0.0627218708395958, 0.08082219213247299, -0.05297984182834625, 0.03181810677051544, -0.06752639263868332]
vector2 = [-0.060268137603998184, -0.05184791910648346, -0.09734241664409637, -0.06888674944639206, 0.07756022873785019, 0.0564102828502655, 0.010685203596949577, 0.0435411737991333, 0.0557655468583107, -0.08356546610593796, 0.02282107062637806, -0.0019932405557483435, 0.018258458003401756, -0.06866960972547531, 0.031197613924741745, -0.06758152693510056, -0.06433585286140442, 0.01601579040288925, -0.054497119039297104, -0.012243565171957016, -0.06424720585346222, 0.07661303877830505, 0.009530718438327322, -0.011023884639143944, -0.03826310858130455, 0.0645303875207901, 0.015738604590296745, -0.007619606330990791, -0.004175021778792143, -0.04191729426383972, 0.07871990650892258, -0.025052480399608612, 0.05521182715892792, 0.04347186163067818, 0.062424302101135254, 0.01907271333038807, -0.0359237939119339, -0.04417156055569649, -0.09361988306045532, 0.036660537323680115, -0.010928142815828323, -0.026738371700048447, 0.04494529217481613, 0.08087397366762161, -0.033828187733888626, 0.09124857932329178, 0.059130147099494934, -0.03742942959070206, 0.012955513782799244, -0.012327208183705807, 0.03306199237704277, -0.055704791098833084, -0.08427928388118744, 0.019375840201973915, 0.03141076862812042, -0.003134226892143488, 0.0006255259504541755, -0.02924959734082222, 0.001949032535776496, -0.003217048244550824, 0.03847776725888252, 0.04603199288249016, 0.0012864007148891687, -0.027571778744459152, 0.09248387813568115, 0.08006276935338974, -0.015705935820937157, -0.08209141343832016, -0.03521576523780823, 0.032819751650094986, -0.038098081946372986, 0.13920921087265015, -0.0067762210965156555, 0.03833401948213577, 0.011534632183611393, 0.057443421334028244, 0.040983691811561584, 0.02150687761604786, 0.06128311529755592, -0.06246856227517128, -0.0015228004194796085, -0.01583990827202797, -0.010286320000886917, 0.09731300920248032, 0.03487100571393967, -0.07705646008253098, -0.014551104977726936, -0.04603608325123787, 0.0030732103623449802, 0.01806531846523285, -0.052569709718227386, 0.024234827607870102, 0.03137487545609474, -0.0320853516459465, -0.10070600360631943, -0.010149399749934673, 0.02892760932445526, -0.041864536702632904, -0.04526665061712265, 0.00975970458239317, -0.022108422592282295, 0.02895745262503624, -0.025937767699360847, 0.007568236440420151, -0.002611148964613676, 0.031830742955207825, -0.09641627967357635, 0.06505972892045975, -0.06067993491888046, -0.022417951375246048, -0.045702628791332245, -0.008593696169555187, -0.053140051662921906, -0.04656229540705681, -0.002426055958494544, -0.08849331736564636, -0.002873412799090147, -0.10064627975225449, 0.057107534259557724, -0.05331995710730553, -0.025697827339172363, 0.0613524504005909, 0.03812190517783165, -0.07837097214698792, -0.007590234745293856, -0.005830368492752314, 0.04278772696852684, -0.0048109786584973335, -0.09032658487558365, 0.07717260718345642, -0.032056551426649094, -0.028463300317525864, 0.0007452909485436976, 0.0009604608057998121, -0.06987305730581284, 0.00940692238509655, -0.05300680547952652, 0.060039814561605453, -0.06655990332365036, -0.004116628784686327, -0.015694310888648033, 0.026966078206896782, 0.05959872528910637, -0.03644569590687752, 0.022458255290985107, 0.001668381504714489, -0.06314554810523987, -0.0020646308548748493, 0.03440365940332413, 0.020726105198264122, 0.06378813832998276, 0.04047898203134537, 0.028752349317073822, -0.05698256939649582, -0.006917532999068499, 0.04529772326350212, 0.011846926994621754, 0.007125353440642357, 0.002804823685437441, -0.00914701260626316, -0.049280449748039246, -0.03899155184626579, -0.00022836934658698738, 0.0433395653963089, -0.12906695902347565, -0.11502309143543243, 0.024407215416431427, 0.062087710946798325, 0.0787295326590538, 0.05454346165060997, 0.005099258851259947, -0.060015153139829636, 0.0425201877951622, 0.0457146093249321, 0.02629419043660164, -0.019210293889045715, 0.03387895226478577, 0.0051735034212470055, 0.034539952874183655, 0.015413721092045307, 0.06418580561876297, 0.012016952969133854, -0.042485881596803665, -0.08238977938890457, -0.02986251749098301, -0.004785032011568546, -0.024383898824453354, 0.010998884215950966, -0.005728630349040031, 0.04963736608624458, 0.025273356586694717, -0.012082311324775219, -0.06207007169723511, 0.025348011404275894, 0.0217976626008749, -0.03617200255393982, 0.05658083036541939, -0.07071997970342636, 0.042317554354667664, -0.04607388749718666, 0.08218041062355042, -0.02332359179854393, -0.034863028675317764, 0.022008586674928665, -0.09140816330909729, 0.02280982956290245, 0.033323533833026886, -0.033084481954574585, -0.004654903430491686, 0.023243745788931847, 0.02829938754439354, 0.03978368267416954, 0.021108249202370644, -0.016330702230334282, 0.038455601781606674, -0.030264372006058693, -0.09704466909170151, 0.004488613922148943, 0.03945883736014366, 0.04405907914042473, -0.018053773790597916, 0.03462745621800423, 0.01732703670859337, 0.003970740363001823, -0.00906444527208805, -0.04298781976103783, 0.03470342233777046, -0.029868919402360916, -0.003515003016218543, 0.028766244649887085, -0.06818360835313797, -0.026268206536769867, 0.020023982971906662, -0.05313184857368469, 0.043916624039411545, -0.10422269254922867, -0.011362730525434017, -0.13513100147247314, -0.008547247387468815, -0.07195743173360825, -0.012030710466206074, -0.07901543378829956, 0.0563400536775589, 0.01714419759809971, 0.027614504098892212, 0.014672365970909595, -0.024746086448431015, 0.006550523452460766, -0.04699664190411568, -0.06953888386487961, 0.038992419838905334, 0.13948693871498108, 0.05648549273610115, -0.06946337223052979, -0.07500273734331131, 0.00891973078250885, 0.007359535899013281, 0.1280461698770523, -0.11097855865955353, -0.06766346096992493, 0.1318819522857666, 0.08025384694337845, 0.053418610244989395, 0.02592308074235916, 0.11786750704050064, 0.03793668746948242, 0.0009800645057111979, 0.11937406659126282, -0.03180338442325592, 0.026381609961390495, -0.004030670505017042, -0.00275554321706295, 0.03128993883728981, 0.07819443196058273, -0.01908355951309204, -0.10350378602743149, 0.013588586822152138, 0.020392058417201042, -0.04743027314543724, 0.11227839440107346, 0.0740869790315628, -0.07184675335884094, 0.04709684103727341, -0.030106065794825554, 0.02868020348250866, 0.05562742054462433, 0.02700944058597088, 0.07009155303239822, 0.03736924007534981, 0.004386126529425383, -0.016657624393701553, 0.08870775252580643, 0.06373231112957001, -0.11071012169122696, -0.05350949615240097, -0.018789425492286682, -0.057370103895664215, 0.0033700107596814632, 0.027412358671426773, -0.0800636038184166, -0.031648993492126465, 0.08805254846811295, 0.00879506766796112, 0.03730088844895363, -0.04079475998878479, -0.0509585402905941, 0.06830716133117676, 0.056273072957992554, 0.019255194813013077, -0.028539035469293594, 0.09375473111867905, 0.0182631965726614, 0.03280184417963028, -0.05149276554584503, -0.05155034735798836, 0.056064918637275696, -0.04758966341614723, 0.056793294847011566, 0.0758911520242691, 0.0030813273042440414, -0.03165356069803238, -0.02023988962173462, 0.025847716256976128, 0.0039415424689650536, -0.010641202330589294, -0.02434704452753067, 0.053021322935819626, 0.038595184683799744, -0.07736929506063461, 0.021490490064024925, 0.062671959400177, 0.01817033626139164, -0.06652817875146866, -0.0031129512935876846, -0.018301405012607574, 0.04626970365643501, -0.04120969772338867, -0.019097615033388138, -0.015646617859601974, -0.024173785001039505, -0.021535562351346016, 0.03655152767896652, 0.14226821064949036, 0.028897006064653397, -0.020693374797701836, 0.029240652918815613, -0.030840065330266953, 0.04138410463929176, 0.032470788806676865, 0.0023929323069751263, 0.01660541631281376, 0.009551380760967731, 0.029598001390695572, -0.05810055509209633, 0.007982632145285606, -0.08142058551311493, 0.06808008253574371, -0.04647214338183403, 0.07793787866830826, -0.002147448481991887, 0.06871569156646729, 0.038489967584609985, -0.09049602597951889, -0.005376765970140696, 0.054401662200689316, -0.031601302325725555, -0.016190698370337486, 0.04433843865990639, -0.0017586887115612626, -0.005737821105867624, 0.05777886509895325, -0.008459252305328846, -0.0466524176299572, -0.01799919456243515, -0.012643303722143173, -0.11377491056919098, -0.05379576236009598, -0.013076303526759148, -0.02139647863805294, 0.0627218708395958, 0.08082219213247299, -0.05297984182834625, 0.03181810677051544, -0.06752639263868332]

def ruby_cosine_distance(vector1, vector2)
  dot_product = vector1.zip(vector2).map{|x, y| x * y }.sum
  norm1 = Math.sqrt(vector1.map{|x| x ** 2 }.sum)
  norm2 = Math.sqrt(vector2.map{|x| x ** 2 }.sum)
  return 1 - (dot_product / (norm1 * norm2))
end

Benchmark.ips do |bm|
  bm.config(time: 5, warmup: 2)

  bm.report('ruby') do
    ruby_cosine_distance(vector1, vector2)
  end

  bm.report('rust') do
    FasterCosine.distance(vector1, vector2)
  end

  bm.compare!
end
